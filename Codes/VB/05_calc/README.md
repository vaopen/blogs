# Calculator

题目源于必修课程《计算机编程与实践》，使用 VB 与 C++ 混合编写，VB 编写界面， C++ 编写核心计算算法并编译成 dll 供 VB 调用

## dll 的编译

建议使用 Dev-C++ (g++) 进行编译，打开 `calculate/calc.dev` 之后点击全部编译运行即可，编译器记得选 32bit 而不是 64bit，将编译完成的 `calc.dll` copy 到 VB 项目文件夹中即可

## 支持的功能

按照作业要求，支持 `+ - * /` 以及 基本的绘图功能

当然，能有加减乘除就可以有其他的，基本实现了 Win10 计算器（科学型）中大部分运算符，功能大多相仿，而绘图功能，自然不会是普通的绘制几个函数，基本可以绘制大多复合函数（像写表达式一样写函数）

有趣的是，前段时间 MicroSoft 刚刚在 GitHub 上开源了 Win10 的 [Calculator](https://github.com/Microsoft/calculator)，而且其第一个采纳的建议就是[在 Win10 Calculator 中加入绘图功能](https://github.com/Microsoft/calculator/issues/338)，不过，限于我当前的水平，看不懂 :joy:

## 为什么要这么做

当然，作业的要求并不高，想要水过去并不难，但是由于对自己有着更高的要求，故试着挑战一下

上学期在中 M 浙大的《数据结构》中稍微了解到了表达式的算法，但是限于当时水平与精力，未能实现

藉此机会，参考 [2.2.4 堆栈应用 表达式求值](https://jdvodrvfb210d.vod.126.net/mooc-video/nos/mp4/2015/08/16/1979019_sd.mp4?ak=7909bff134372bffca53cdc2c17adc27a4c38c6336120510aea1ae1790819de8d86e907c01560a8776d8eae2f67f38fa5970eda0513b3240302cc1ec4e1275903059f726dc7bb86b92adbc3d5b34b132ce1a5ac006f324f3a00d1019ae5ad63e) 用 VB 实现了大多数算法，但是…… 太累了，语法累（甚至连逻辑短路机制都没有，循环中控制没有 break、continue 简直令人崩溃），对类的弱支持更累，最后写不下去了

后来想了一段时间，想过几种方案

-  VB 编写界面，调用 C++ 写的 dll
-  VB 编写界面，调用 Python 写的 exe
-  使用 PyQt5 完成全部内容

第二种方案否决的最快，因为我发现 VB 并没用使用进程通信的接口（或者我不知道），第三种是由于曾经用代码直接编写界面导致我对 GUI 的设计一直很抵触，而第一种又是最最适合而且可行性最高的方案（之前学完 C++ 后实现了几个算法就没再用过了，这次正好再捡起来并开始刷算法）

## 尚需解决的问题

-  C++ （dll）部分
   -  [ ] 垃圾回收问题
   -  [x] 负号的问题
   -  [ ] 变量的支持
   -  [x] 一元运算符（前缀、后缀）
   -  [x] 广义阶乘精度较低的问题
   -  [ ] 广义阶乘负数域的支持
   -  [ ] 部分英文名称并不合适
-  VB （GUI）部分
   -  [ ] 输入审核机制
   -  [x] 部分数值溢出
   -  [ ] 运算值预览
   -  [ ] deg、dms、左下角按键的支持（现在没搞懂它们都有啥用）
   -  [ ] win10 calc 中 DEG HYP F-E 的支持

## 注意事项

-  由于部分运算尚不稳定，请尽可能地使用括号对歧义处进行包裹
-  部分运算符的用法更符合数学习惯而不是 win10 calc 的用法
-  绘制图形时切勿变量前加常数，当前的机制为 VB 中纯字符串替换，类似于宏的原理，dll 中尚不支持变量的使用

---

[Open Sourse @ notev](https://github.com/SigureMo/notev/tree/master/Codes/VB)
